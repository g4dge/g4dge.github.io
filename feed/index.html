<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anti-Feed</title>

  <!-- Favicons / manifest (relative to /feed) -->
  <link rel="icon" type="image/png" sizes="16x16" href="../icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../icons/favicon-32x32.png">
  <link rel="shortcut icon" href="../icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="../icons/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="../icons/android-chrome-512x512.png">
  <link rel="apple-touch-icon" href="../icons/apple-touch-icon.png">
  <link rel="manifest" href="../icons/site.webmanifest">

  <style>
    :root {
      --card-radius: 12px;
      --border: #eaeaea;
      --muted: #6b7280;
      --chip: #f3f4f6;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font: 16px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; color:#111; }
    .wrap { max-width: 840px; margin: 24px auto; padding: 0 16px; }
    header.top { display:flex; justify-content:space-between; align-items:center; margin: 8px 0 16px; }
    header.top h1 { font-size: 28px; font-weight: 800; letter-spacing: -0.01em; }
    header.top small { color: var(--muted); }

    /* Card */
    article.card {
      border: 1px solid var(--border);
      border-radius: var(--card-radius);
      padding: 14px;
      margin-bottom: 12px;
      display: grid;
      gap: 12px;
      align-items: start;
    }
    /* Two-column when there's an image */
    .has-img {
      grid-template-columns: 92px 1fr;
    }

    /* Thumbnail */
    .thumb {
      width: 92px; height: 92px;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid var(--border);
      flex: 0 0 92px;
    }
    .thumb img {
      width: 100%; height: 100%; object-fit: cover;
      display: block;
    }

    h2 {
      font-size: 19px; line-height: 1.3; margin-bottom: 4px;
    }
    h2 a { color:#0a0a0a; text-decoration: none; }
    h2 a:hover { text-decoration: underline; }

    .meta { display:flex; align-items:center; gap:8px; color: var(--muted); font-size: 13px; margin-bottom: 6px; flex-wrap: wrap; }
    time { opacity: .85; }
    .tag {
      font-size: 12px;
      padding: .2em .6em;
      border-radius: 999px;
      background: var(--chip);
      border: 1px solid var(--border);
      color:#222;
    }
    .pinned { background: #fff7ed; border-color:#fed7aa; }

    .summary {
      color:#1f2937; font-size: 15px;
      display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
    }

    @media (max-width: 560px) {
      .wrap { margin-top: 16px; }
      .has-img { grid-template-columns: 72px 1fr; }
      .thumb { width:72px; height:72px; }
      h2 { font-size: 18px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="top">
      <h1>Newswipe</h1>
      <small>Chronological • No algorithm • No ads</small>
    </header>

    <main id="feed">Loading…</main>
  </div>

  <script>
  (async () => {
    const res = await fetch('data/items.json', { cache: 'no-store' });
    const items = await res.json();
    const feed = document.getElementById('feed');
    feed.innerHTML = '';

    for (const it of items) {
      // Build card
      const card = document.createElement('article');
      const hasImg = !!it.image; // optional field provided by fetch.py (if present)
      card.className = 'card' + (hasImg ? ' has-img' : '');

      // Left: thumbnail (optional)
      const left = hasImg ? `
        <div class="thumb">
          <img src="${it.image}" alt="" loading="lazy" decoding="async">
        </div>
      ` : '';

      // Meta chips
      const chips = `
        <div class="meta">
          <time datetime="${it.isoDate}">${new Date(it.isoDate).toLocaleString('en-GB', { hour12: false })}</time>
          ${it.source ? `<span class="tag">${it.source}</span>` : ''}
          ${it.pinned ? `<span class="tag pinned">Pinned</span>` : ''}
        </div>
      `;

      // Summary (tight + clamped)
      const snip = (it.summary || '').trim();
      const summary = snip ? `<p class="summary">${snip}</p>` : '';

      card.innerHTML = `
        ${left}
        <div class="body">
          <h2><a href="${it.link}" target="_blank" rel="noopener">${it.title}</a></h2>
          ${chips}
          ${summary}
        </div>
      `;

      feed.appendChild(card);
    }
  })();
  </script>
</body>
</html>